/* Copyright ( c ) 2021, FlyNeves - Diogo Neves. All rights reserved. | textFieldRangeJS - 1.0.0  | LICENSE.md or MIT License ( MIT )*/
(function(ba,E,H){function Y(a){return"object"==typeof a?(a.tagName||a.nodeName||a.localName).toLowerCase():a?a.toLowerCase():!1}function qa(a){if(!a.P){for(;"html"!=Y(a)&&null!=a;)a=Z(a);return Z(a)||a.Y}return a}function Z(a){"body"!=Y(a)||a.parentElement?a.parentElement?a=a.parentElement:a=a.parentNode:a=E.P;return a}function S(a){return ba.getComputedStyle?ba.getComputedStyle(a):a.currentStyle}function T(a){Z(a).removeChild(a)}function J(a,b){a.textContent||typeof("string"==a.textContent)?a.textContent=
b:a.nodeValue||typeof("string"==a.nodeValue)?a.nodeValue=b:a.innerText=b}function aa(a){var b=0,e=0,d,f=g.value;if(typeof("number"==g.selectionEnd)&&"number"==typeof g.selectionStart)b=g.selectionStart,e=g.selectionEnd;else if((d=E.selection.createRange())&&d.parentElement()==g){var m=f.length;var k=f.replace(/\r\n/g,B);e=g.createTextRange(g);e.moveToBookmark(d.getBookmark());d=g.createTextRange(g);d.collapse(!1);-1<e.compareEndPoints("StartToEnd",d)?b=e=m:(b=-e.moveStart("character",-m),b+=k.slice(0,
b).split(B).length-1,-1<e.compareEndPoints("EndToEnd",d)?e=m:(e=-e.moveEnd("character",-m),e+=k.slice(0,e).split(B).length-1))}a&&(b="\r"==f.substring(b-1,b)?b++:b,e="\r"==f.substring(e-1,e)?e++:e,b+=f.substring(0,b).length-L(f.substring(0,b)).length,e+=f.substring(0,e).length-L(f.substring(0,e)).length);return{selectionStart:b,selectionEnd:e}}function U(a){var b=aa(a);a=b.selectionStart;b=b.selectionEnd;return{u:g.value.substring(b,g.value.length),v:g.value.substring(0,a),B:g.value.substring(a,b),
selectionStart:a,selectionEnd:b}}function M(a,b){a=a.toString();var e=g.style,d=e.height,f=e.lineHeight,m=g.value;var k=aa();var r=k.selectionStart,n=k.selectionEnd;if(ca){var h=g.value;g.value=a;var l=g.createTextRange(g);l.collapse(!0);l.moveEnd("character",g.value.length);l.moveStart("character",0);k=l.boundingWidth;c.i||(c.j=E.createElement("textarea"),c.body.appendChild(c.j));var p=c.j;var u=p.style;p.value="d";p.style.cssText=da;u.height="0";u.borderWidth="0";u.padding="0";u.lineHeight=S(g).lineHeight;
p=c.j.scrollHeight-c.j.offsetHeight;e.lineHeight="normal";l=l.boundingHeight;g.value=h;e.lineHeight=f;b||(T(c.j),c.i=!1);for(x(r,n);l>p;)l-=p}else{c.i||(c.cloneNode=E.createElement(ea),c.m=E.createElement(ea),c.I=E.createTextNode(v),c.w=E.createTextNode(v),c.cloneNode.style.cssText=c.D,c.m.R="left",c.m.appendChild(c.w),c.cloneNode.appendChild(c.I),c.cloneNode.appendChild(c.m),c.body.appendChild(c.cloneNode));if("string"!=typeof a)return T(c.cloneNode),c.i=!1,!0;a.substring(a.length-1,a.length)==B&&
(a=a.substring(0,a.length-1));h=c.m;l=h.style;c.l&&(a=a.split(C).join(v).replace(/[ ]+/g,"\u00a0"));c.cloneNode.style.lineHeight=c.H.lineHeight;J(c.I,v);J(c.w,a);l.lineHeight=c.H.lineHeight;l.display="inline-block";l.R="left";k=h.clientWidth;J(c.w,"|");p=h.clientHeight;l.lineHeight="normal";l=h.clientHeight;c.cloneNode.style.lineHeight=f;b||(T(c.cloneNode),c.i=!1)}b&&(c.i=!0);g.value=a;e.height=p+"px";g.scrollTop=10;a=parseInt((g.scrollHeight-c.A)/p)*p;e.height=d;g.value=m;x(r,n);return{height:a,
width:k,charsHeight:l,lineHeight:p}}function x(a,b,e){function d(k){for(var r=0,n=g.value.split(v),h=0;r<k;)n[r]+n[r+1]==V&&(r++,h++),r++;return k-h}"number"!=typeof a&&(a=0,b=H);"number"!=typeof b&&(b=a);var f=g.value,m=f.length;a=a>m?m:0>a?0:a;b=b>m?m:0>b?0:b;a="\r"==f.substring(a-1,a)?a++:a;b="\r"==f.substring(b-1,b)?b++:b;m=f.substring(0,a).length-L(f.substring(0,a)).length;f=f.substring(0,b).length-L(f.substring(0,b)).length;a=d(a);b=d(b);e&&(a+=m,b+=f);g.setSelectionRange?(g.focus(),g.setSelectionRange(a,
b)):g.createTextRange?(e=g.createTextRange(g),e.collapse(!0),e.moveEnd("character",b),e.moveStart("character",a),e.select()):(g.selectionStart=a,g.selectionEnd=b,g.focus())}function ma(a,b,e){a=a.toString();a+=v;var d=U(),f=d.B,m=d.u;d=d.v;var k=d.length,r=a.length;"insert"==e?(d=d+f+a,k=d.length,g.value=d+m,b?x(k-r,k):x(k)):(g.value=d+a+m,b?x(k,k+r):x(k+r));return F()}function P(a,b){b=b||c.a;for(var e=b.length;0<e--;){var d=b[e];if(d.b==a)return d.width}return 0}function fa(a,b,e){a.collapse(!0);
a.moveEnd("character",e||b);a.moveStart("character",b);return a}function Q(a){var b;g.focus();var e=[],d=U(),f=d.selectionStart,m=d.selectionEnd,k=m,r=g.value,n,h=[],l=0,p=b=0,u=r.split(v),G=u.length,N=g.style.margin;m=!0;g.style.margin="0";g.value=B+" break line default "+V;C=g.value;C=1<C.split(V).length?V:B;g.value=r;x(f,k);if(ca){x(0);for(n=g.createTextRange(g);p<G;){var t=u[p];if(1==c.h.split(t).length){if("\n"==t||"\r"==t)c.a[c.a.length]={width:0,b:t};else{g.value=t;var w=g.createTextRange(g).boundingWidth;
l=l<w?w:l;c.a[c.a.length]={width:w,b:t}}c.c[c.c.length]={b:t,amount:r.split(t).length-1};c.h=c.h+t}w=P(t);l=l<w?w:l;p++}c.g=c.a}else{var q=E.createElement(ea);var y=E.createTextNode(v);var z=E.createTextNode(v);var A=E.createElement("caret-position");A.style.display="inline";var K=q.style;K.cssText=c.D;K.overflowX=c.J;K.overflowY=c.K;c.body.appendChild(q);q.appendChild(y);q.appendChild(A);q.appendChild(z);for(var D=c.U;p<G;){t=u[p];if(1==c.h.split(t).length){var R=c.a.length;"\n"==t||"\r"==t?(c.a[R]=
{width:0,b:t},c.g[R]={width:0,b:t}):(J(y," "==t&&c.l?"\u00a0":t),w=A.offsetLeft-q.offsetLeft,0!=w||" "!=t||D||(J(y," "==t?"\u00a0":t),w=A.offsetLeft-q.offsetLeft,D=c.V-w+"px"),l=l<w?w:l,c.a[R]={width:w,b:t},c.g[R]={width:w-c.paddingLeft,b:t});c.c[c.c.length]={b:t,amount:r.split(t).length-1};c.h=c.h+t}w=P(t);l=l<w?w:l;p++}D&&(K.width=D,c.U=D)}g.value=r;if(21>g.scrollWidth-g.clientWidth&&!c.l){l+=1;if("allText"==a)a=r;else{u=c.o;G=d.v.split(v);K=G.length;b=r.split(v);t=K+d.B.length+d.u.length;p=m=0;
D="page"==a?c.f:5*u;w=a=0;d=d.selectionEnd;for(D=D>c.f?c.f+u:D;(a+=u)<=D;)p++;for(a=K;-1<a--&&w<p;)m<c.s?m+=P(G[a],c.g):(m=0,w++);w=0;u=0<a?a+1:0;a=d;for(m=0;a++<t&&w<p;)m<c.s?m+=P(b[a],c.g):(m=0,w++);a=b=r.substring(u,a);b=u}if(ca){m=d=a.length;n.collapse(!0);n.moveEnd("character",d+b);n.moveStart("character",0);p=n.boundingHeight;c.C=n.offsetLeft;for(n=fa(n,d).boundingLeft-c.paddingLeft-c.C;-1<d--;)if(t=a.substring(d,d+1),"\r"!=t&&(n-=P(t),n<=l||t==B))y=L(a.substring(0,b+d)).length,q=g.createTextRange(g),
q.collapse(!0),q.moveEnd("character",y),q.moveStart("character",0),u=q.boundingHeight,u!=p?(n=a.substring(d,m),n!=v&&(h[h.length]=n),m-=n.length,d=m+1,n=fa(q,b+d).boundingLeft-c.paddingLeft-c.C,p=u):t==B&&(n=a.substring(d,m),n!=v&&(h[h.length]=n),d--,q=g.createTextRange(g),q.collapse(!0),q.moveEnd("character",b+d),n=fa(q,b+d).boundingLeft-c.paddingLeft-c.C,m=d);h[h.length]=a.substring(0,m);x(f,k)}else{m=d=a.length;J(y,r.substring(0,b+m));J(z,r.substring(b+m,H));p=A.offsetTop-q.offsetTop;for(n=A.offsetLeft-
q.offsetLeft-c.paddingLeft-c.borderLeftWidth;0<d--;)t=a.substring(d,d+1),f=r.substring(0,d)+r.substring(d+1,H),"\r"!=t&&(n-=P(t),n<=l&&(J(A,t+"\u00a0"),J(y,f.substring(0,b+d)),J(z,f.substring(b+d,H)),u=A.offsetTop-q.offsetTop,u!=p&&(n=a.substring(d+1,m),n!=v&&(h[h.length]=n),m-=n.length,n=A.offsetLeft-q.offsetLeft-c.paddingLeft-c.borderLeftWidth,p=u)));0>d&&(h[h.length]=a.substring(0,m));T(q)}for(d=h.length-1;-1<d;)e[e.length]=h[d],d--;h=[];l=0;for(f=e.length;l<f;)q=e[l],0<=q.search(/[\r]+/g)&&0>
q.search(/[\n] +/g)&&(q=q.replace(/\r/g,V)),q=q.replace(/\r/g,v),y=q.substring(0,2).split(v),z=h.length,y[0]==B||y[1]==B?(A=B.length,q==B?0<z?(y=h[z-1].replace(/\r/g,v),y.substring(y.length-1,y.length)==B?h[z]=C:h[z-1]+=C):h[0]=C:0<z?(y=h[z-1].replace(/\r/g,v),y.substring(y.length-1,y.length)==B?(h[z]=C,h[z+1]=q.substring(A,H)):(h[z-1]+=C,h[z]=q.substring(A,H))):(h[0]=C,h[1]=q.substring(A,H))):"string"==typeof q&&(h[z]=q),l++;e=h;m=!1}else if(c.l)e[0]=r;else{h=r.split(v);f=v;for(d=0;h[d];)l=h[d],
f+=l,l==B&&(e[e.length]=f,f=v),d++;f!=v&&(e[e.length]=f)}h=e.join(v);h.substring(h.length-1,H)!=B||c.l||(e[e.length]=v);q=e.length;h=v;f=q-1;d=0;for(p=b;d<q;){l=e[d]||v;var W=l.length;p+=W;if(p>k){h=r.substring(0,p);f=d;break}d++}f==q-1&&(h=r.substring(0,p));r=e[f].substring(0,e[f].length-(p-k));g.style.margin=N;return{lines:e,selectionEnd:k,O:f,T:h,M:r,S:b,F:h.length,G:p-W,L:m,c:c.c}}function I(a){a.element&&(ha=a,a=a.element);c=new ra(a);c.o=M("|").lineHeight}function sa(a){for(var b=X.length;b--;){var e=
X[b];if(e.element==a){var d=S(a);d=na(d)+"display:block;"+da;if(e.N==d||a.value==e.element.value)return e;X.splice(b,1);break}}return!1}function na(a){for(var b=0,e=[];oa[b];)e[e.length]=oa[b]+":"+a[ta[b]]+";",b++;return e.join(v)}function L(a){return a.replace(/\r/g,v)}function pa(){return"direction boxSizing overflowX overflowY borderTopWidth borderRightWidth borderBottomWidth borderLeftWidth borderStyle borderColor paddingTop paddingRight paddingBottom paddingLeft fontStyle fontVariant fontWeight fontStretch fontSize fontSizeAdjust lineHeight fontFamily textAlign textTransform textIndent textDecoration letterSpacing wordSpacing tabSize mozTabSize display whiteSpace wordWrap wordBreak wordSpacing overflow color borderTopColor borderTopStyle borderLeftColor borderLeftStyle borderBottomColor borderBottomStyle borderRightColor borderRightStyle".split(" ")}
function ra(a){function b(O){var ia=k[O];k[O]="0";var ja=h-a.offsetWidth;k[O]=ia;return ja}function e(O){var ia=k[O];k[O]="0";var ja=l-a.offsetHeight;k[O]=ia;return ja}var d=sa(a);if(d)return d;var f=a.offsetWidth,m=a.offsetHeight,k=a.style,r=k.borderWidth,n=k.padding;a.style.padding=0;var h=a.offsetWidth,l=a.offsetHeight;d=S(a);k=a.style;var p=e("borderTopWidth")||parseFloat(d.borderTopWidth)||0,u=b("borderLeftWidth")||parseFloat(d.borderLeftWidth)||0,G=e("borderBottomWidth")||parseFloat(d.borderBottomWidth)||
0,N=b("borderRightWidth")||parseFloat(d.borderRightWidth)||0;a.style.padding=n;d=S(a);k=a.style;k.borderWidth=0;h=a.offsetWidth;l=a.offsetHeight;n=e("paddingTop")||parseFloat(d.paddingTop)||0;var t=b("paddingLeft")||parseFloat(d.paddingLeft)||0,w=e("paddingBottom")||parseFloat(d.paddingBottom)||0,q=b("paddingRight")||parseFloat(d.paddingRight)||0;a.style.borderWidth=r;d=S(a);k=a.style;r=n+w;var y=a.clientWidth,z=a.clientHeight,A=k.overflow;k.overflow="hidden";y=a.clientWidth-y;z=a.clientHeight-z;
k.overflow=A;A=a.clientWidth-(t+q);var K=a.clientHeight-r,D=a.offsetHeight-p-G,R=qa(a),W=na(d)+"display:block;"+da;D=K+m-a.clientHeight-p-G;f=A+f-a.clientWidth-u-N-(ka?1:0);g=a;this.N=W;this.D=W+"width:"+f+"px;height:"+D+"px;";this.K=0==y?"hidden":"scroll";this.J=0==z?"hidden":"scroll";this.body=R.body;this.H=d;this.value=a.value;this.borderTopWidth=p;this.borderLeftWidth=u;this.borderBottomWidth=G;this.borderRightWidth=N;this.paddingTop=n;this.paddingLeft=t;this.paddingBottom=w;this.paddingRight=
q;this.A=r;this.s=A+3;this.f=K;this.V=f;this.a=[];this.g=[];this.c=[];this.h=v;this.i=!1;this.element=a;this.l="input"==Y(a);X[X.length]=this;return this}function F(a){if(!(this instanceof F))return new F(a);a=a?a:Q("line");var b=a.T,e=M(a.M,!0).width,d=M(b).charsHeight,f=U(),m=f.selectionEnd,k=f.selectionStart,r=g.value,n=0,h=0,l=g.cloneNode(!1);var p=l.style;f=c.o;var u;a.L||(l.value=b,p.visibility="hidden",p.position="absolute",p.padding="0",p.overflowX=c.J,p.overflowY=c.K,Z(g).appendChild(l),
p.height=f+"px",l.scrollTop=50,n=l.scrollHeight-f,n=Math.abs(parseInt(n/f)),x(k,m),l.value=r,h=parseInt((l.scrollHeight-c.A)/f),T(l));b=c.f;p=n*f+c.paddingTop;g.getBoundingClientRect?u=g.getBoundingClientRect():u={top:0,left:0};g.scrollTop=b+c.A-p;b=p+c.paddingBottom-c.f;g.scrollTop=b;g.scrollLeft=e-c.s;b=g.scrollTop;l=g.scrollLeft;f=U();p=p-b-c.paddingTop;var G=e-l;this.element=g;this.charBreak=C;this.top=p;this.x=this.left=G;this.y=p;this.offsetTop=p+b+c.paddingTop;this.offsetLeft=e+l+c.paddingLeft;
this.viewTop=p+c.paddingTop+u.top+c.borderTopWidth;this.viewLeft=G+c.paddingLeft+u.left+c.borderLeftWidth;this.lineHeight=c.o;this.borderWidth={top:c.borderTopWidth,left:c.borderLeftWidth,bottom:c.borderBottomWidth,right:c.borderRightWidth};this.padding={top:c.paddingTop,left:c.paddingLeft,bottom:c.paddingBottom,right:c.paddingRight};this.charsHeight=d;this.charsWidth=c.g;this.charsList=a.c;this.textFieldHeight=c.f;this.textFieldWidth=c.s;this.currentLine=n;this.currentLineText=r.substring(a.G,a.F);
this.currentLineStart=a.G;this.currentLineEnd=a.F;this.afterSelection=f.u;this.beforeSelection=f.v;this.selection=f.B;this.selectionStart=k;this.selectionEnd=m;this.numberOfLines=h;if(ha)for(var N in this)ha[N]=this[N];return this}function la(a){I(a);return F()}F.prototype={breakLines:function(a){I(Object(this));var b=Q("allText"),e=b.lines;if(!b.L){b=0;var d=aa(),f=d.selectionStart;for(d=d.selectionEnd;b<e.length-1;){var m=e[b].split(C);2>m.length&&(e[b]=m.join(v)+C);b++}a&&(g.value=e.join(v),x(f,
d));F()}return e},lines:function(){I(Object(this));var a=Q("allText");F(a);return a.lines},size:function(a,b){I(Object(this));return M(a,b)},moveCaret:function(a){function b(n){k=0<k?k:0;n=0<n?n:0;var h=f.length;n=n>h-1?h-1:n;for(var l=f[n].split(v).length-1,p=0,u=m;p<n;)u+=f[p].length,p++;if(36==a||35==a)35==a?h-1==k?x(H):x(u+l):x(u);else{l=d.M;h=l.length;l=M(l,!0).width/l.length;p=M(f[n].substring(0,h),!0).width/h;l<p?h--:l>p&&h++;if(n==k){if(40==a||34==a)u=H}else u+=h;x(u);M(!1)}}function e(){for(var n=
0,h=0;h<=c.f;)h+=c.o,n++;--n;0>n&&(n=1);return 33==a?k-n||0:k+n||f.length-1}I(Object(this));var d=33==a||34==a?Q("page"):Q("line"),f=d.lines,m=d.S,k=d.O;if(37==a||39==a){var r=aa().selectionEnd;37==a?x(r-1):x(r+1)}else switch(a){case 33:case 34:b(e());break;case 35:case 36:b(k);break;case 38:b(k-1);break;case 40:b(k+1)}return F()},select:function(a,b,e){I(Object(this));x(a,b,e);return F()},replaceSelection:function(a,b){I(Object(this));return ma(a,b?!1:!0,"replace")},insert:function(a,b){I(Object(this));
return ma(a,b,"insert")},setCaret:function(a,b){I(Object(this));if("number"!=typeof b)x(a,!1,1);else{var e=Q("allText").lines,d=e.length-1,f=0,m=0;b=a>d?-.1:b;for(a=a<=d?a:d;f<=d;){var k=L(e[f]).length;if(a==f){-.1>=b&&(-.1==b?b=k:(b=k-Math.abs(b),b=0>b?0:b));b>k?x(m+k-1):x(m+b,!1,1);break}m+=k;f++}}return F()},appendString:function(a,b,e){b=b.toString();I(Object(this));var d=g.value,f=U();a="\r"==d.substring(a-1,a)?a++:a;a+=d.substring(0,a).length-L(d.substring(0,a)).length;g.value=d.substring(0,
a)+b+d.substring(a,H);e?x(a,a+b.length):x(f.selectionStart,f.selectionEnd);return F()},findString:function(a){a=a.toString();for(var b=0,e=L(g.value),d=e.length,f=a.length,m=[];b<d;){var k=b+f;e.substring(b,k)==a&&(m[m.length]={start:b,end:k,Z:a},b+=f);b++}return 0==m.length?!1:m},refresh:function(){I(Object(this));return F()}};var g,c={},ha,X=[],ka=E.W,ca=ka&&9>ka?!0:!1,B="\n",V="\r"+B,da="position:absolute;visibility:hidden;",v="",ea="text-field-clone",ta=pa(),oa=function(){for(var a=pa(),b=a.length-
1,e=-1;e++<b;)for(var d=a[e].split(v),f=-1,m=d.length-1;f++<m;){var k=d[f];1<"QWERTYUIOPASDFGHJKLZXCVBNM".split(k).length&&(d[f]="-"+Y(k),a[e]=d.join(v))}return a}(),C;"undefined"!==typeof module&&"undefined"!==typeof module.exports?module.exports=la:"function"===typeof define&&define.amd?define("textFieldRange",[],function(){return la}):ba.textFieldRange=la})("undefined"!=typeof window?window:this,document,Infinity);
